type Invoice @entity(immutable: false) {
  id: ID!
  invoiceId: String
  state: String
  createdAt: BigInt
  paidAt: BigInt
  seller: User
  buyer: User
  price: BigInt
  amountPaid: BigInt
  releasedAt: BigInt
  releaseHash: Bytes
  paymentTxHash: Bytes
  fee: BigInt
  contract: Bytes
}

type SmartInvoice @entity(immutable: false) {
  id: ID!
  invoiceId: String
  buyer: User
  seller: User
  escrow: Bytes
  paymentToken: Bytes
  state: String
  paidAt: BigInt
  createdAt: BigInt
  releasedAt: BigInt
  expiresAt: BigInt
  cancelAt: BigInt
  price: BigInt
  amountPaid: BigInt
  metaInvoice: MetaInvoice
  contract: Bytes!
}

type MetaInvoice @entity(immutable: false) {
  id: ID!
  invoiceId: String
  buyer: User
  price: BigInt
  contract: Bytes
  invoices: [SmartInvoice!]! @derivedFrom(field: "metaInvoice")
}

type User @entity(immutable: false) {
  id: ID!
  ownedInvoices: [Invoice!]! @derivedFrom(field: "seller")
  paidInvoices: [Invoice!]! @derivedFrom(field: "buyer")
  ownedSmartInvoices: [SmartInvoice!]! @derivedFrom(field: "seller")
  paidSmartInvoices: [SmartInvoice!]! @derivedFrom(field: "buyer")
  metaInvoices: [MetaInvoice!]! @derivedFrom(field: "buyer")
}
